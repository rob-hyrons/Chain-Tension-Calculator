<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chain Tension Calculator (Multi-Size)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; flex-wrap: wrap; gap: 30px;}
        
        h1 { width: 100%; text-align: center; color: #2c3e50; margin-top: 0; }
        
        /* Left Column: Controls */
        .controls { flex: 1; min-width: 320px; }
        
        /* Right Column: Visualization */
        .visualization { flex: 1.5; min-width: 320px; display: flex; flex-direction: column; align-items: center; }
        
        .section { margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border-left: 5px solid #007bff; }
        .section h3 { margin-top: 0; color: #007bff; font-size: 1.1em; margin-bottom: 15px; }
        
        .input-group { margin-bottom: 12px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9em; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; box-sizing: border-box; }
        select { background-color: #fff; cursor: pointer; border-color: #aaa; }
        
        .note { font-size: 0.8em; color: #666; margin-top: 2px; }

        .results-box { background-color: #eef2f5; padding: 15px; border-radius: 8px; margin-top: 10px; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #ddd; }
        .result-row:last-child { border-bottom: none; border: none; padding-bottom: 0; }
        .result-value { font-weight: bold; font-size: 1.1em; }

        .status-safe { color: #28a745; font-weight: bold; }
        .status-danger { color: #dc3545; font-weight: bold; }

        /* Canvas Styling */
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            box-shadow: inset 0 0 20px #f0f0f0;
        }

        /* Highlights */
        #presetSelector { border: 2px solid #007bff; background-color: #eaf4ff; color: #0056b3; font-weight: bold; }
        #inputWeight { border-color: #dc3545; background-color: #fff5f5; }
    </style>
</head>
<body>

<div class="container">
    <h1>Chain Tension Calculator</h1>

    <!-- LEFT SIDE: INPUTS -->
    <div class="controls">
        
        <!-- Quick Select -->
        <div class="section" style="border-left-color: #6610f2;">
            <h3>1. Select Chain Size</h3>
            <div class="input-group">
                <label>Standard Sizes (Presets)</label>
                <select id="presetSelector" onchange="applyPreset()">
                    <option value="custom">Custom / Manual Input</option>
                    <option value="half" selected>1/2 inch (Standard)</option>
                    <option value="five_eighths">5/8 inch (Heavy)</option>
                    <option value="three_quarters">3/4 inch (Extra Heavy)</option>
                </select>
                <div class="note">Selecting a size automatically sets Plate Dia & Break Strain.</div>
            </div>
        </div>

        <!-- Machine Setup -->
        <div class="section">
            <h3>2. Dimensions & Specs</h3>
            <div class="input-group">
                <label>Plate Wheel Diameter (mm)</label>
                <input type="number" id="plateDia" value="230" oninput="setCustomMode()">
            </div>
            <div class="input-group">
                <label>Max Breaking Strain (Newtons)</label>
                <input type="number" id="chainBreak" value="18000" oninput="setCustomMode()">
            </div>
            <div class="input-group">
                <label>Barrel Diameter (mm)</label>
                <input type="number" id="barrelDia" value="127" oninput="updateAll()">
            </div>
            <div class="input-group">
                <label>Safety Factor</label>
                <input type="number" id="safetyFactor" value="5" oninput="updateAll()">
                <div class="note">Standard Lifting = 5:1</div>
            </div>
        </div>

        <!-- The Load -->
        <div class="section" style="border-left-color: #dc3545;">
            <h3>3. Input Load Weight</h3>
            <div class="input-group">
                <label>Weight to Lift (kg)</label>
                <input type="number" id="inputWeight" value="150" oninput="updateAll()">
            </div>
        </div>

        <!-- Results Text -->
        <div class="results-box">
            <div class="result-row">
                <span>Force on Chain:</span>
                <span class="result-value" id="resForceN">0 N</span>
            </div>
            <div class="result-row">
                <span>Safety Factor:</span>
                <span class="result-value" id="resSafety">0.0 : 1</span>
            </div>
            <div class="result-row">
                <span>Status:</span>
                <span class="result-value" id="resStatus">Checking...</span>
            </div>
            <div class="result-row" style="margin-top:10px; color:#555">
                 <span>Max Safe Load (kg):</span>
                 <span class="result-value" id="resMaxLoad">0</span>
            </div>
        </div>
    </div>

    <!-- RIGHT SIDE: CANVAS -->
    <div class="visualization">
        <h3>System Visualization</h3>
        <canvas id="sysDiagram" width="500" height="450"></canvas>
        <p class="note" style="text-align:center;">Diagram scales automatically.</p>
    </div>
</div>

<script>
    // PRESET DATA
    const presets = {
        "half": { plate: 230, strain: 18000 },
        "five_eighths": { plate: 288, strain: 22400 },
        "three_quarters": { plate: 345, strain: 29000 }
    };

    function applyPreset() {
        const select = document.getElementById('presetSelector');
        const val = select.value;

        if (val !== 'custom' && presets[val]) {
            // Update Inputs
            document.getElementById('plateDia').value = presets[val].plate;
            document.getElementById('chainBreak').value = presets[val].strain;
            
            // Trigger calculation
            updateAll();
        }
    }

    function setCustomMode() {
        // If user types manually, switch dropdown to "Custom"
        document.getElementById('presetSelector').value = "custom";
        updateAll();
    }

    function updateAll() {
        const results = calculateValues();
        updateUI(results);
        drawDiagram(results);
    }

    function calculateValues() {
        const barrelDia = parseFloat(document.getElementById('barrelDia').value) || 1;
        const plateDia = parseFloat(document.getElementById('plateDia').value) || 1;
        const breakStrainN = parseFloat(document.getElementById('chainBreak').value) || 0;
        const safetyFactor = parseFloat(document.getElementById('safetyFactor').value) || 1;
        const weightKg = parseFloat(document.getElementById('inputWeight').value) || 0;

        // Calculations
        const ratio = barrelDia / plateDia;
        const forceOnChainKg = weightKg * ratio;
        const forceOnChainN = forceOnChainKg * 9.81;
        
        let currentSF = 0;
        if (forceOnChainN > 0) currentSF = breakStrainN / forceOnChainN;

        const maxSafeChainTensionN = breakStrainN / safetyFactor;
        const maxSafeChainTensionKg = maxSafeChainTensionN / 9.81;
        
        // Reverse calculation for Max Load
        const maxLoadWeight = maxSafeChainTensionKg / ratio;

        return {
            barrelDia, plateDia, weightKg, 
            forceOnChainN, forceOnChainKg, currentSF, 
            safetyFactor, maxLoadWeight
        };
    }

    function updateUI(data) {
        document.getElementById('resForceN').innerText = data.forceOnChainN.toFixed(0) + " N";
        document.getElementById('resSafety').innerText = data.currentSF.toFixed(1) + " : 1";
        document.getElementById('resMaxLoad').innerText = Math.floor(data.maxLoadWeight) + " kg";

        const statusEl = document.getElementById('resStatus');
        if (data.currentSF >= data.safetyFactor) {
            statusEl.innerText = "SAFE";
            statusEl.className = "result-value status-safe";
        } else {
            statusEl.innerText = "UNSAFE";
            statusEl.className = "result-value status-danger";
        }
    }

    function drawDiagram(data) {
        const canvas = document.getElementById('sysDiagram');
        const ctx = canvas.getContext('2d');
        const w = canvas.width;
        const h = canvas.height;

        // Clear Canvas
        ctx.clearRect(0, 0, w, h);

        // Center Point
        const centerX = 300;
        const centerY = 180;
        
        // SCALE CALCULATION
        // We want the plate wheel to fit on screen. 
        // 3/4 inch chain has 345mm plate. Let's make that max size approx 140px radius.
        const scale = 140 / 345; 
        
        const plateRad = (data.plateDia / 2) * scale;
        const barrelRad = (data.barrelDia / 2) * scale;
        
        const sprocketRad = 25; 
        const sprocketX = 50;
        const sprocketY = centerY;

        // 1. Draw Chain Lines
        ctx.beginPath();
        ctx.setLineDash([8, 4]);
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#333';
        // Top Chain
        ctx.moveTo(sprocketX, sprocketY - sprocketRad);
        ctx.lineTo(centerX, centerY - plateRad);
        // Bottom Chain
        ctx.stroke();
        
        ctx.beginPath();
        ctx.setLineDash([]); // Solid
        ctx.lineWidth = 1;
        ctx.moveTo(sprocketX, sprocketY + sprocketRad);
        ctx.lineTo(centerX, centerY + plateRad);
        ctx.stroke();

        // 2. Chain Force Arrow & Text
        const forceText = Math.round(data.forceOnChainN) + " N";
        ctx.fillStyle = '#d63031';
        ctx.font = "bold 14px Arial";
        ctx.fillText(forceText, 140, centerY - plateRad - 20);
        
        drawArrow(ctx, 160, centerY - plateRad - 10, 100, centerY - plateRad - 10, '#d63031');

        // 3. Draw Plate Wheel
        ctx.beginPath();
        ctx.arc(centerX, centerY, plateRad, 0, 2 * Math.PI);
        ctx.fillStyle = '#b2bec3'; 
        ctx.fill();
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#636e72';
        ctx.stroke();
        
        // Label Plate
        ctx.fillStyle = '#2d3436';
        ctx.font = "12px Arial";
        ctx.textAlign = "center";
        ctx.fillText(`Plate Ø${data.plateDia}`, centerX, centerY - plateRad - 5);

        // 4. Draw Barrel
        ctx.beginPath();
        ctx.arc(centerX, centerY, barrelRad, 0, 2 * Math.PI);
        ctx.fillStyle = '#74b9ff'; 
        ctx.fill();
        ctx.strokeStyle = '#0984e3';
        ctx.stroke();
        
        ctx.fillStyle = 'white';
        ctx.font = "10px Arial";
        ctx.fillText(`Ø${data.barrelDia}`, centerX, centerY + 4);

        // 5. Draw Small Sprocket
        ctx.beginPath();
        ctx.arc(sprocketX, sprocketY, sprocketRad, 0, 2 * Math.PI);
        ctx.fillStyle = '#636e72';
        ctx.fill();
        ctx.stroke();

        // 6. Draw Load
        const ropeX = centerX + barrelRad;
        const ropeTopY = centerY;
        const ropeBottomY = centerY + 150;

        ctx.beginPath();
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#8B4513';
        ctx.moveTo(ropeX, ropeTopY);
        ctx.lineTo(ropeX, ropeBottomY);
        ctx.stroke();

        // Box
        const boxSize = 50;
        ctx.fillStyle = '#d63031'; 
        ctx.fillRect(ropeX - boxSize/2, ropeBottomY, boxSize, boxSize);
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;
        ctx.strokeRect(ropeX - boxSize/2, ropeBottomY, boxSize, boxSize);

        // Load Text
        ctx.fillStyle = 'white';
        ctx.font = "bold 12px Arial";
        ctx.fillText(data.weightKg + "kg", ropeX, ropeBottomY + 30);
    }

    function drawArrow(ctx, fromX, fromY, toX, toY, color) {
        const headlen = 10; 
        const angle = Math.atan2(toY - fromY, toX - fromX);
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.moveTo(fromX, fromY);
        ctx.lineTo(toX, toY);
        ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
        ctx.moveTo(toX, toY);
        ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
        ctx.stroke();
    }

    // Initialize with default (Half inch)
    applyPreset();
</script>

</body>
</html>